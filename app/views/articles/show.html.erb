<%= javascript_include_tag "fetch-api-data", "data-turbo-track": "reload" %>

<div class="card my-4">
  <h1 class="card-title"><%= @article.title %></h1>

  <div class="card-subtitle float-right">
    <h2>🍗 Votes</h2>
    #Votes: <b><%=  @article.votes_for.count %></b> <br/>
    Average: <b><%= @article.weighted_average %></b> <br/>


    👍 #likes: <%= @article.get_likes().size %> <br/>
    👎🏾 #dislikes: <%= @article.get_dislikes().size %> <br/>

    </div>

 <!--  <img class="float-right ..." src="path/to/image.jpg">
  <p class="card-subtitle">tailwind float right: https://tailwindcss.com/docs/float
 -->


  <p class="card-subtitle">
    <%= author_and_date(@article) %>
  </p>

   <p><%= render_main_image(@article) %></p>

  <div class="card-body">
    <%= @article.body %>
  </div>

  <div class="card-actions">
    <%= link_to "Edit", edit_article_path(@article), class: 'btn' %>
  </div>

   <div class="card-carlessian-footer border-t-2 dark:border-neutral-600" >
    <%= render_tags @article %> |
    <%= render_votes @article %>
  </div>

  <div class="card-footer">
    <h2>Some 🪄 GenAI stuff coming soon...</h2>

      <div id="my-post-content" >
        <p id="my-placeholder" >
          <b>1. ❌ This aaa placeholder will be replaced with API data. (bard test!)</b>
          </p>
      </div>

      <div id="my-article-synoptic" >
        <p id="my-placeholder" >2. ❌ This placeholder will be replaced with a synoptic of the whole article (Palm/LangChainRb).</p>
      </div>

      <div id="my-article-image-synoptic" >
        <p id="my-placeholder" >3. ❌ This placeholder will be replaced with information on the image (Gemini).</p>
      </div>

          <script>
          // Call the fetchApiData function after the DOM is loaded
          document.addEventListener('DOMContentLoaded', fetchApiData);
          fetchApiData();
        </script>


      <%#= render_comments @article %>
      <%#= render_comment_form @article %>
      <%#= render_article_footer @article %>
    </div>

  <hr/>
  <% if (current_user.is_admin rescue false) %>
    <div class="card-footer">
        <h1>Admin only: votes</h1>

        <p>Weighted Average = <b><%= @article.weighted_average %></b></p>

      <ol class="list-decimal">
      <% @article.votes_for.each do |vote| %>
        <li>

          <b><%= voter_info(vote) rescue "Err: #{$!}" %></b>
          <%= vote.inspect %></li>
      <% end %>
      </ol>
    </div>

  <% end %>
</div>
